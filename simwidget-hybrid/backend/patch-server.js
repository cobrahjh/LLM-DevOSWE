/**\n * Manual patch to integrate Component Markers into server.js\n * This script will add the necessary imports and initialization\n */\n\nconst fs = require('fs');\nconst path = require('path');\n\nconst serverFile = path.join(__dirname, 'server.js');\nconst backupFile = path.join(__dirname, 'server.js.backup-markers');\n\nconsole.log('Patching server.js to add Component Markers integration...');\n\n// Create backup\nfs.copyFileSync(serverFile, backupFile);\nconsole.log('âœ“ Backup created');\n\n// Read current content\nlet content = fs.readFileSync(serverFile, 'utf8');\n\n// 1. Add import after camera-system import\nconst importTarget = \"const cameraSystem = require('./camera-system');\";\nconst newImport = \"const ComponentMarkersIntegration = require('./component-markers-integration');\";\n\nif (!content.includes('component-markers-integration')) {\n    content = content.replace(\n        importTarget,\n        importTarget + '\\n' + newImport\n    );\n    console.log('âœ“ Added component markers import');\n} else {\n    console.log('! Component markers import already exists');\n}\n\n// 2. Add initialization after camera controller\nconst initTarget = \"const cameraController = new CameraController();\";\nconst newInit = \"const componentMarkers = new ComponentMarkersIntegration();\";\n\nif (!content.includes('new ComponentMarkersIntegration')) {\n    content = content.replace(\n        initTarget,\n        initTarget + '\\n' + newInit\n    );\n    console.log('âœ“ Added component markers initialization');\n} else {\n    console.log('! Component markers initialization already exists');\n}\n\n// 3. Add API routes after express.json() middleware\nconst middlewareTarget = \"app.use(express.json());\";\nconst newMiddleware = \"\\n// Initialize component markers API routes\\ncomponentMarkers.initializeRoutes(app);\";\n\nif (!content.includes('componentMarkers.initializeRoutes')) {\n    content = content.replace(\n        middlewareTarget,\n        middlewareTarget + newMiddleware\n    );\n    console.log('âœ“ Added component markers API routes');\n} else {\n    console.log('! Component markers API routes already exist');\n}\n\n// 4. Update server version\ncontent = content.replace(\n    \"const SERVER_VERSION = '1.10.0';\",\n    \"const SERVER_VERSION = '1.11.0';\"\n);\nconsole.log('âœ“ Updated server version to 1.11.0');\n\n// 5. Replace the root route handler with enhanced version\nconst rootRouteMatch = content.match(/app\\.get\\('\\/', \\(req, res\\) => {[\\s\\S]*?}\\);/);\nif (rootRouteMatch) {\n    const enhancedRootRoute = `app.get('/', (req, res) => {\n    // Enhanced home page with component markers\n    const html = componentMarkers.generateEnhancedHomePage(SERVER_VERSION, keySender.getVersion());\n    res.send(html);\n});`;\n    \n    content = content.replace(rootRouteMatch[0], enhancedRootRoute);\n    console.log('âœ“ Enhanced root route with component markers');\n} else {\n    console.log('! Could not find root route to enhance');\n}\n\n// Write the patched content\nfs.writeFileSync(serverFile, content, 'utf8');\n\nconsole.log('\\nðŸŽ‰ Component Markers integration completed!');\nconsole.log('\\nNew features added:');\nconsole.log('  - ðŸ’° Cost/processing intensive indicators');\nconsole.log('  - âš¡ Real-time operation markers');\nconsole.log('  - ðŸ”Œ API call indicators');\nconsole.log('  - ðŸŽ¯ User input requirement markers');\nconsole.log('  - ðŸ“Š Compute-heavy operation indicators');\nconsole.log('  - ðŸ”„ Background processing markers');\nconsole.log('\\nNew API endpoints:');\nconsole.log('  - GET /api/components - List all components with markers');\nconsole.log('  - GET /api/components/:name/markers - Get markers for specific component');\nconsole.log('  - GET /api/components/costs - Get cost estimates');\nconsole.log('  - POST /api/components/:name/markers - Register new component markers');\nconsole.log('\\nRestart the server to see the changes!');\n"