<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AI Autopilot - SimGlass</title>
    <!-- Shared Styles -->
    <link rel="stylesheet" href="/ui/shared/widget-common.css">
    <link rel="stylesheet" href="/ui/shared/themes.css">
    <link rel="stylesheet" href="/ui/shared/settings-panel.css">
    <link rel="stylesheet" href="/ui/shared/widget-customizer.css">
    <link rel="stylesheet" href="/ui/shared/responsive.css">
    <!-- Widget Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Settings -->
    <button class="settings-btn" id="settings-btn" title="Settings">&#9881;</button>

    <div class="widget-container" id="widget-root">

        <!-- Header -->
        <div class="widget-header">
            <span class="widget-title">AI AUTOPILOT</span>
            <div class="header-controls">
                <button class="ai-master-toggle" id="ai-toggle">OFF</button>
                <span class="connection-status" id="conn-status" title="Connection status"></span>
            </div>
        </div>

        <!-- Phase Display -->
        <div class="phase-section" id="phase-section">
            <div class="phase-row">
                <span class="phase-label">Phase:</span>
                <span class="phase-name" id="phase-name">PREFLIGHT</span>
            </div>
            <div class="phase-bar">
                <div class="phase-progress" id="phase-progress"></div>
                <div class="phase-dots" id="phase-dots"></div>
            </div>
            <div class="phase-targets" id="phase-targets">
                <span class="target" id="target-alt">--- ft</span>
                <span class="target" id="target-spd">--- kt</span>
                <span class="target" id="target-hdg">HDG ---°</span>
            </div>
        </div>

        <!-- Main Content: AP Status + Command Log -->
        <div class="main-content">
            <!-- AP Status Column -->
            <div class="ap-status-panel">
                <div class="panel-title">AP STATUS</div>
                <div class="ap-status-row" id="status-hdg">
                    <span class="status-label">HDG</span>
                    <span class="status-value" id="val-hdg">---°</span>
                    <span class="status-check" id="check-hdg"></span>
                </div>
                <div class="ap-status-row" id="status-alt">
                    <span class="status-label">ALT</span>
                    <span class="status-value" id="val-alt">---</span>
                    <span class="status-check" id="check-alt"></span>
                </div>
                <div class="ap-status-row" id="status-vs">
                    <span class="status-label">VS</span>
                    <span class="status-value" id="val-vs">---</span>
                    <span class="status-check" id="check-vs"></span>
                </div>
                <div class="ap-status-row" id="status-spd">
                    <span class="status-label">SPD</span>
                    <span class="status-value" id="val-spd">---</span>
                    <span class="status-check" id="check-spd"></span>
                </div>
                <div class="ap-status-row" id="status-nav">
                    <span class="status-label">NAV</span>
                    <span class="status-value" id="val-nav">OFF</span>
                    <span class="status-check" id="check-nav"></span>
                </div>
            </div>

            <!-- Command Log Column -->
            <div class="command-log-panel">
                <div class="panel-title">COMMAND LOG</div>
                <div class="command-log" id="command-log">
                    <div class="log-empty">AI Autopilot inactive</div>
                </div>
            </div>
        </div>

        <!-- Advisory Panel -->
        <div class="advisory-panel" id="advisory-panel">
            <div class="advisory-header">
                <span class="advisory-icon">&#9432;</span>
                <span class="advisory-title">AI Advisory</span>
                <button class="advisory-ask" id="advisory-ask" title="Request advisory">Ask AI</button>
            </div>
            <div class="advisory-content" id="advisory-content">
                <span class="advisory-idle">No active advisories</span>
            </div>
            <div class="advisory-actions" id="advisory-actions" style="display:none">
                <button class="advisory-btn accept" id="advisory-accept">Accept</button>
                <button class="advisory-btn dismiss" id="advisory-dismiss">Dismiss</button>
            </div>
        </div>

        <!-- Footer -->
        <div class="widget-footer">
            <span class="footer-item">Aircraft: <span id="aircraft-name">C172</span></span>
            <span class="footer-item">Override: <span id="override-count">0</span> active</span>
            <span class="widget-version">v1.0.0</span>
        </div>

    </div>

    <!-- Shared Scripts -->
    <script src="/ui/shared/settings-panel.js"></script>
    <script src="/ui/shared/theme-switcher.js"></script>
    <script src="/ui/shared/widget-customizer.js"></script>
    <script src="/ui/shared/safe-channel.js"></script>
    <script src="/ui/shared/themes.js"></script>
    <script src="/ui/shared/platform-utils.js"></script>
    <script src="/ui/shared/telemetry.js"></script>
    <script src="/ui/shared/feedback-section.js"></script>
    <script src="/ui/shared/widget-base.js"></script>
    <!-- AI Autopilot Modules -->
    <script src="data/aircraft-profiles.js"></script>
    <script src="modules/flight-phase.js"></script>
    <script src="modules/rule-engine.js"></script>
    <script src="modules/command-queue.js"></script>
    <script src="modules/llm-advisor.js"></script>
    <!-- Widget Script -->
    <script src="pane.js"></script>
    <script>
        window.widget = new AiAutopilotPane();
        window.addEventListener('beforeunload', () => window.widget?.destroy());

        const settings = new SettingsPanel();
        settings.registerThemeSection();
        window.widget.registerSettingsSection(settings);
        const customizer = new WidgetCustomizer({ widgetId: 'ai-autopilot', settingsPanel: settings });
        document.getElementById('settings-btn')?.addEventListener('click', () => settings.toggle());
    </script>
</body>
</html>
