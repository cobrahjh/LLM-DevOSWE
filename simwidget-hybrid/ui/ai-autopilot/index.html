<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AI Autopilot - SimGlass</title>
    <!-- Shared Styles -->
    <link rel="stylesheet" href="/ui/shared/widget-common.css">
    <link rel="stylesheet" href="/ui/shared/themes.css">
    <link rel="stylesheet" href="/ui/shared/settings-panel.css">
    <link rel="stylesheet" href="/ui/shared/widget-customizer.css">
    <link rel="stylesheet" href="/ui/shared/responsive.css">
    <!-- Widget Styles -->
    <link rel="stylesheet" href="styles.css?v=10">
</head>
<body>
    <div class="widget-container" id="widget-root">

        <!-- Header -->
        <div class="widget-header">
            <span class="widget-title">AI AUTOPILOT</span>
            <div class="header-controls">
                <button class="settings-btn header-settings" id="settings-btn" title="Settings">&#9881;</button>
                <button class="simbrief-import-btn" id="simbrief-import" title="Import SimBrief Plan / Clear Flight Plan">&#9992; FPL</button>
                <button class="ai-master-toggle" id="ai-toggle">OFF</button>
                <button class="ai-auto-controls" id="auto-controls-btn">AI CONTROLS</button>
                <!-- <button class="debug-toggle" id="debug-toggle" title="Debug Panel">DBG</button> -->
                <!-- <button class="tuning-toggle" id="tuning-toggle" title="Tuning Panel">TUNE</button> -->
                <span class="connection-status" id="conn-status" title="Connection status"></span>
            </div>
        </div>

        <!-- Two-column layout: main left, tuning right -->
        <div class="page-body" id="page-body">
        <div class="page-main" id="page-main">

        <!-- Phase Display -->
        <div class="phase-section" id="phase-section">
            <div class="phase-row">
                <span class="phase-label">Phase:</span>
                <span class="phase-name" id="phase-name">PREFLIGHT</span>
            </div>
            <div class="phase-bar">
                <div class="phase-progress" id="phase-progress"></div>
                <div class="phase-dots" id="phase-dots"></div>
            </div>
            <div class="phase-targets" id="phase-targets">
                <span class="target" id="target-alt">--- ft</span>
                <span class="target" id="target-spd">--- kt</span>
                <span class="target" id="target-hdg">HDG ---°</span>
            </div>
        </div>

        <!-- Airport/Runway Info (auto-detected) -->
        <div class="airport-bar" id="airport-bar" style="display:none">
            <span class="airport-icao" id="airport-icao">----</span>
            <span class="airport-name" id="airport-name"></span>
            <span class="airport-rwy-label">RWY</span>
            <select class="airport-rwy-select" id="airport-rwy-select" title="Select runway (overrides auto-detection)">
                <option value="">--</option>
            </select>
            <span class="airport-elev" id="airport-elev">--- ft</span>
            <span class="airport-dist" id="airport-dist">--.- nm</span>
        </div>

        <!-- ATC Ground Control Panel (auto-shown during ground ops) -->
        <div class="atc-panel" id="atc-panel" style="display:none">
            <div class="atc-header">ATC GROUND</div>
            <div class="atc-body">
                <span class="atc-phase" id="atc-phase">INACTIVE</span>
                <span class="atc-instruction" id="atc-instruction"></span>
                <span class="atc-route" id="atc-route"></span>
            </div>
        </div>

        <!-- Weather Panel (wind compensation display) -->
        <div class="weather-panel" id="weather-panel" style="display:none">
            <div class="weather-header">WEATHER</div>
            <div class="weather-body">
                <span class="weather-wind" id="weather-wind">WIND ---/--kt</span>
                <span class="weather-components" id="weather-components">X-WIND --kt · H-WIND --kt</span>
                <span class="weather-correction" id="weather-correction">DRIFT CORR ---°</span>
                <span class="weather-turbulence" id="weather-turbulence"></span>
            </div>
        </div>

        <!-- Flight Plan Report (shown after SimBrief import) -->
        <div class="fpl-report" id="fpl-report" style="display:none">
            <div class="fpl-report-header" id="fpl-report-toggle">
                <span class="fpl-report-icon">&#9992;</span>
                <span class="fpl-report-title">FLIGHT PLAN</span>
                <span class="fpl-report-route" id="fpl-report-route">----</span>
                <span class="fpl-report-chevron" id="fpl-report-chevron">&#9660;</span>
            </div>
            <div class="fpl-report-body" id="fpl-report-body">
                <div class="fpl-report-summary">
                    <div class="fpl-report-field">
                        <span class="fpl-field-label">CRUISE</span>
                        <span class="fpl-field-value" id="fpl-rpt-alt">---</span>
                    </div>
                    <div class="fpl-report-field">
                        <span class="fpl-field-label">DISTANCE</span>
                        <span class="fpl-field-value" id="fpl-rpt-dist">---</span>
                    </div>
                    <div class="fpl-report-field">
                        <span class="fpl-field-label">WAYPOINTS</span>
                        <span class="fpl-field-value" id="fpl-rpt-wps">---</span>
                    </div>
                    <div class="fpl-report-field">
                        <span class="fpl-field-label">SOURCE</span>
                        <span class="fpl-field-value" id="fpl-rpt-source">---</span>
                    </div>
                </div>
                <div class="fpl-report-route-string" id="fpl-rpt-route-str"></div>
                <div class="fpl-report-waypoints" id="fpl-rpt-wps-list"></div>
                <div class="fpl-report-commands">
                    <div class="fpl-cmd-label" id="fpl-cmd-toggle" style="cursor:pointer">AI INSTRUCTIONS <span id="fpl-cmd-chevron">&#9660;</span></div>
                    <div class="fpl-cmd-content" id="fpl-cmd-content">
                        <div class="fpl-cmd-row">
                            <input type="text" class="fpl-cmd-input" id="fpl-cmd-input" placeholder="e.g. Fly at FL180, avoid KDEN airspace, descend early..." autocomplete="off">
                            <button class="fpl-cmd-send" id="fpl-cmd-send">SEND</button>
                        </div>
                        <div class="fpl-cmd-history" id="fpl-cmd-history"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content: AP Status + Command Log -->
        <div class="main-content">
            <!-- AP Status Column -->
            <div class="ap-status-panel">
                <div class="panel-title">AP STATUS</div>
                <div class="ap-status-row" id="status-hdg">
                    <span class="status-label">HDG</span>
                    <span class="status-value" id="val-hdg">---°</span>
                    <span class="status-check" id="check-hdg"></span>
                </div>
                <div class="ap-status-row" id="status-alt">
                    <span class="status-label">ALT</span>
                    <span class="status-value" id="val-alt">---</span>
                    <span class="status-check" id="check-alt"></span>
                </div>
                <div class="ap-status-row" id="status-vs">
                    <span class="status-label">VS</span>
                    <span class="status-value" id="val-vs">---</span>
                    <span class="status-check" id="check-vs"></span>
                </div>
                <div class="ap-status-row" id="status-spd">
                    <span class="status-label">SPD</span>
                    <span class="status-value" id="val-spd">---</span>
                    <span class="status-check" id="check-spd"></span>
                </div>
                <div class="ap-status-row" id="status-nav">
                    <span class="status-label">NAV</span>
                    <span class="status-value" id="val-nav">OFF</span>
                    <span class="status-check" id="check-nav"></span>
                </div>
            </div>

            <!-- Resize Handle -->
            <div class="main-resize-handle" id="main-resize-handle"></div>

            <!-- Command Log Column -->
            <div class="command-log-panel">
                <div class="panel-title">COMMAND LOG</div>
                <div class="command-log" id="command-log">
                    <div class="log-empty">AI Autopilot inactive</div>
                </div>
            </div>
        </div>

        <!-- Advisory Panel -->
        <div class="advisory-panel" id="advisory-panel">
            <div class="advisory-header">
                <span class="advisory-icon">&#9432;</span>
                <span class="advisory-title">AI Advisory</span>
                <button class="advisory-stop-voice" id="advisory-stop-voice" title="Stop Sally talking" style="display:none">&#9724; Stop</button>
                <span class="advisory-volume" id="advisory-volume" title="Sally volume">
                    <span class="vol-icon" id="vol-icon">&#128264;</span>
                    <input type="range" id="vol-slider" min="0" max="100" step="5">
                </span>
                <button class="advisory-mic" id="advisory-mic" title="Speak to AI">&#127908;</button>
                <button class="advisory-ask" id="advisory-ask" title="Request advisory">Ask AI</button>
            </div>
            <div class="advisory-input-row" id="advisory-input-row">
                <input type="text" class="advisory-text-input" id="advisory-text-input" placeholder="Ask the AI anything..." autocomplete="off">
                <button class="advisory-send" id="advisory-send" title="Send">&#9654;</button>
            </div>
            <div class="advisory-content" id="advisory-content">
                <span class="advisory-idle">No active advisories</span>
            </div>
            <div class="advisory-actions" id="advisory-actions" style="display:none">
                <button class="advisory-btn accept" id="advisory-accept">Accept</button>
                <button class="advisory-btn dismiss" id="advisory-dismiss">Dismiss</button>
            </div>
        </div>

        <!-- Debug Panel -->
        <!-- COMMENTED OUT 2026-02-19
        <div class="debug-panel" id="debug-panel" style="display:none">
            <div class="debug-resize-handle" id="debug-resize-handle" title="Drag to resize"></div>
            <div class="debug-header">
                <span class="debug-title">DEBUG</span>
                <div class="debug-filters">
                    <button class="debug-filter active" data-filter="all">ALL</button>
                    <button class="debug-filter active" data-filter="api">API</button>
                    <button class="debug-filter active" data-filter="ws">WS</button>
                    <button class="debug-filter active" data-filter="llm">LLM</button>
                    <button class="debug-filter active" data-filter="cmd">CMD</button>
                </div>
                <button class="debug-popout" id="debug-popout" title="Open in new window">&#8599;</button>
                <button class="debug-clear" id="debug-clear">CLEAR</button>
            </div>
            <div class="debug-log" id="debug-log"></div>
            <div class="debug-stats" id="debug-stats">
                <span>API: <span id="ds-api">0</span></span>
                <span>WS: <span id="ds-ws">0</span>/s</span>
                <span>LLM: <span id="ds-llm">0</span></span>
                <span>RT: <span id="ds-llm-rt">--</span>ms</span>
                <span>CMD: <span id="ds-cmd">0</span></span>
            </div>
        </div>
        -->

        </div><!-- /page-main -->

        <!-- Tuning Panel (right column) -->
        <!-- COMMENTED OUT 2026-02-19
        <div class="tuning-panel" id="tuning-panel" style="display:none">
            <div class="tuning-header">
                <span class="tuning-title">TUNING</span>
                <button class="tuning-reset" id="tuning-reset" title="Reset to defaults">RESET</button>
            </div>
            <div class="tuning-body" id="tuning-body"></div>
        </div>
        -->

        </div><!-- /page-body -->

        <!-- Footer -->
        <div class="widget-footer">
            <span class="footer-item">Aircraft: <span id="aircraft-name">C172</span></span>
            <span class="footer-item">Override: <span id="override-count">0</span> active</span>
            <span class="widget-version">v1.0.0</span>
        </div>

    </div>

    <!-- Shared Scripts -->
    <script src="/ui/shared/settings-panel.js"></script>
    <script src="/ui/shared/theme-switcher.js"></script>
    <script src="/ui/shared/widget-customizer.js"></script>
    <script src="/ui/shared/safe-channel.js"></script>
    <script src="/ui/shared/themes.js"></script>
    <script src="/ui/shared/platform-utils.js"></script>
    <script src="/ui/shared/terrain-grid.js"></script>
    <script src="/ui/shared/telemetry.js"></script>
    <script src="/ui/shared/feedback-section.js"></script>
    <script src="/ui/shared/voice-announcer.js"></script>
    <script src="/ui/shared/widget-base.js"></script>
    <!-- AI Autopilot Modules -->
    <script src="data/aircraft-profiles.js"></script>
    <script src="data/flight-procedures.js"></script>
    <script src="data/atc-phraseology.js"></script>
    <script src="modules/flight-phase.js"></script>
    <script src="modules/rule-engine-core.js"></script>
    <script src="modules/command-queue.js?v=2"></script>
    <!-- Lazy-loaded modules (loaded by pane.js on demand):
         - Phase modules: rule-engine-{ground,takeoff,cruise,approach}.js
         - Conditional: wind-compensation.js (airborne phases)
         - Conditional: atc-controller.js (ground phases)
         - Conditional: llm-advisor.js (on first "Ask AI" click) -->
    <!-- Widget Script -->
    <script src="pane.js?v=10"></script>
    <script>
        window.widget = new AiAutopilotPane();
        window.addEventListener('beforeunload', () => window.widget?.destroy());

        const settings = new SettingsPanel();
        window.widget.registerSettingsSection(settings);
        settings.registerThemeSection();
        const customizer = new WidgetCustomizer({ widgetId: 'ai-autopilot', settingsPanel: settings });
        document.getElementById('settings-btn')?.addEventListener('click', () => settings.toggle());
    </script>
  <script src="/ui/shared/help-panel.js"></script>
</body>
</html>
