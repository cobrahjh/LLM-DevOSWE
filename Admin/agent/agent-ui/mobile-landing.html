<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>Hive Connect</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 30px 0;
        }

        .logo {
            font-size: 48px;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .subtitle {
            color: #888;
            font-size: 14px;
        }

        .status-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #888;
        }

        .status-dot.online { background: #00ff88; box-shadow: 0 0 10px #00ff88; }
        .status-dot.offline { background: #ff4444; }

        .services {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .service-card {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
            color: #fff;
            transition: all 0.2s ease;
        }

        .service-card:hover, .service-card:active {
            background: rgba(255,255,255,0.15);
            transform: scale(1.02);
        }

        .service-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .service-icon.kittbox { background: linear-gradient(135deg, #667eea, #764ba2); }
        .service-icon.kittlive { background: linear-gradient(135deg, #ff6b6b, #feca57); }
        .service-icon.oracle { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .service-icon.relay { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .service-icon.hivemind { background: linear-gradient(135deg, #43e97b, #38f9d7); }
        .service-icon.simwidget { background: linear-gradient(135deg, #00d4ff, #0099cc); }
        .service-icon.iris { background: linear-gradient(135deg, #9b59b6, #8e44ad); }

        .service-info h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .service-info p {
            font-size: 13px;
            color: #888;
        }

        .service-status {
            margin-left: auto;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #888;
        }

        .service-status.online { background: #00ff88; }
        .service-status.offline { background: #ff4444; }

        .qr-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
        }

        .qr-section h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #888;
        }

        #qrcode {
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            display: inline-block;
        }

        .install-btn {
            display: block;
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            cursor: pointer;
        }

        .install-btn:active {
            transform: scale(0.98);
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #555;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üêù</div>
            <h1>Hive Connect</h1>
            <p class="subtitle">DevOSWE Hive Network</p>
        </div>

        <div class="status-bar">
            <div class="status-dot" id="mainStatus"></div>
            <span id="statusText">Checking connection...</span>
        </div>

        <div class="services" id="servicesList">
            <a href="#" class="service-card" id="kittbox-link">
                <div class="service-icon kittbox">ü§ñ</div>
                <div class="service-info">
                    <h3>KittBox</h3>
                    <p>AI Command Center</p>
                </div>
                <div class="service-status" id="kittbox-status"></div>
            </a>

            <a href="#" class="service-card" id="kittlive-link">
                <div class="service-icon kittlive">üéôÔ∏è</div>
                <div class="service-info">
                    <h3>Kitt Live</h3>
                    <p>Voice Assistant</p>
                </div>
                <div class="service-status" id="kittlive-status"></div>
            </a>

            <a href="#" class="service-card" id="hivemind-link">
                <div class="service-icon hivemind">üìä</div>
                <div class="service-info">
                    <h3>Hive-Mind</h3>
                    <p>Activity Monitor</p>
                </div>
                <div class="service-status" id="hivemind-status"></div>
            </a>

            <a href="#" class="service-card" id="oracle-link">
                <div class="service-icon oracle">üîÆ</div>
                <div class="service-info">
                    <h3>Oracle</h3>
                    <p>LLM Backend</p>
                </div>
                <div class="service-status" id="oracle-status"></div>
            </a>

            <a href="#" class="service-card" id="relay-link">
                <div class="service-icon relay">üì°</div>
                <div class="service-info">
                    <h3>Relay</h3>
                    <p>Message Queue</p>
                </div>
                <div class="service-status" id="relay-status"></div>
            </a>

            <a href="#" class="service-card" id="simwidget-link">
                <div class="service-icon simwidget">‚úàÔ∏è</div>
                <div class="service-info">
                    <h3>SimWidget</h3>
                    <p>Flight Sim Controls</p>
                </div>
                <div class="service-status" id="simwidget-status"></div>
            </a>

            <a href="#" class="service-card" id="iris-link">
                <div class="service-icon iris">üîÆ</div>
                <div class="service-info">
                    <h3>Iris (ai-pc)</h3>
                    <p>Vision AI + LLM Backup</p>
                </div>
                <div class="service-status" id="iris-status"></div>
            </a>
        </div>

        <button class="install-btn" id="installBtn" style="display:none;">
            üì≤ Install App
        </button>

        <div class="qr-section" id="qrSection">
            <h3>Scan to connect from another device</h3>
            <div id="qrcode"></div>
        </div>

        <div class="footer">
            <p>DevOSWE Hive v1.0</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script>
        // Detect host IP
        const host = window.location.hostname || 'localhost';
        const services = {
            kittbox: { port: 8585, path: '/' },
            kittlive: { port: 8686, path: '/' },
            hivemind: { port: 8701, path: '/' },
            oracle: { port: 3002, path: '/api/health' },
            relay: { port: 8600, path: '/api/health' },
            simwidget: { port: 8080, path: '/api/health' },
            iris: { port: 3003, path: '/api/health', host: '192.168.1.162' }
        };

        // Set service links
        document.getElementById('kittbox-link').href = `http://${host}:8585`;
        document.getElementById('kittlive-link').href = `http://${host}:8686`;
        document.getElementById('hivemind-link').href = `http://${host}:8701`;
        document.getElementById('oracle-link').href = `http://${host}:3002`;
        document.getElementById('relay-link').href = `http://${host}:8600`;
        document.getElementById('simwidget-link').href = `http://${host}:8080/ui/interaction-wheel/`;
        document.getElementById('iris-link').href = `http://192.168.1.162:3003/api/health`;

        // Check service status
        async function checkService(name, port, path, customHost) {
            const targetHost = customHost || host;
            try {
                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 3000);
                const response = await fetch(`http://${targetHost}:${port}${path}`, {
                    signal: controller.signal,
                    mode: 'no-cors'
                });
                clearTimeout(timeout);
                return true;
            } catch {
                return false;
            }
        }

        async function checkAllServices() {
            let onlineCount = 0;

            for (const [name, config] of Object.entries(services)) {
                const online = await checkService(name, config.port, config.path, config.host);
                const statusEl = document.getElementById(`${name}-status`);
                if (statusEl) {
                    statusEl.classList.toggle('online', online);
                    statusEl.classList.toggle('offline', !online);
                }
                if (online) onlineCount++;
            }

            const mainStatus = document.getElementById('mainStatus');
            const statusText = document.getElementById('statusText');

            if (onlineCount === Object.keys(services).length) {
                mainStatus.classList.add('online');
                mainStatus.classList.remove('offline');
                statusText.textContent = 'All services online';
            } else if (onlineCount > 0) {
                mainStatus.classList.add('online');
                statusText.textContent = `${onlineCount}/${Object.keys(services).length} services online`;
            } else {
                mainStatus.classList.add('offline');
                statusText.textContent = 'Hive offline';
            }
        }

        // Generate QR code
        function generateQR() {
            const url = `http://${host}:8585/mobile-landing.html`;
            const qr = qrcode(0, 'M');
            qr.addData(url);
            qr.make();
            document.getElementById('qrcode').innerHTML = qr.createImgTag(5);
        }

        // PWA Install
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBtn').style.display = 'block';
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                document.getElementById('installBtn').style.display = 'none';
            }
        });

        // Init
        checkAllServices();
        generateQR();
        setInterval(checkAllServices, 10000);
    </script>
</body>
</html>
